#Config for Volumetric Exploration Planner
replan_pos_threshold: 0.3
replan_yaw_threshold: 0.3

max_new_segments: 0
min_new_segments: 0
max_new_tries: 2000
min_new_tries: 500
min_new_value: 10.0

verbose_modules: false
build_modules_on_init: true
expand_batch: 3
visualize_gain: true
highlight_executed_trajectory: true

log_performance: false
performance_log_dir: "/home/yi/risk-aware_planning/src/mav_active_3d_planning"


map:
  type: "LFMap"

system_constraints:
  v_max: 1.5
  a_max: 0.5
  yaw_rate_max: 0.2
  yaw_accel_max: 0.1  
  collision_radius: 0.8

trajectory_generator:
  collision_optimistic: false
  bounding_volume_args: "/map_bounding_volume"
  clearing_radius: 0.5

  type: "RRTStar"
  all_semgents_feasible: true
  crop_segments: true
  crop_margin: 0.3
  crop_min_length: 1.0
  min_path_length: 1.0
  max_extension_range: 2.0
  maximum_tries: 2000
  sampling_rate: 10.0
  sample_yaw: true
  rewire_root: true
  rewire_intermediate: true
  reinsert_root: true
  max_rewire_range: 10.0
  # max_rewire_range: 3.0
  max_density_range: 0.5
  n_neighbors: 10


trajectory_evaluator:
  type: "RRTStarEvaluatorAdapter"
  
  following_evaluator:
    type: "ContinuousYawPlanningEvaluator"
    n_directions: 8
    n_sections_fov: 1
    update_range: 5.0
    update_gain: 0.0
    update_sections_separate: false

    following_evaluator:
      type: "UncertaintyEvaluator"
      visualize_sensor_view: false
      bounding_volume_args: "/target_bounding_volume"
      localmap_encoder: "/home/yi/risk-aware_planning/src/uncertainty_predictor/checkpoints/VIO/traced/traced_localmap_encoder.pt"
      drift_predictor: "/home/yi/risk-aware_planning/src/uncertainty_predictor/checkpoints/VIO/traced/traced_drift_predictor.pt"
      sensor_model:
        type: "IterativeRayCaster"
        sampling_time: 0.0
        ray_length: 4.0
        focal_length: 386.126953125
        resolution_x: 640
        resolution_y: 480
        downsampling_factor: 1.0

      cost_computer:
        type: "SegmentLength"
        accumulate: true

      value_computer:
        type: "AccumulateValue"
        following_value_computer:
          # type: "ExponentialDiscount"
          # cost_scale: 0.05
          type: "RelativeGain"

      # value_computer:
      #   type: "ExponentialDiscount"
      #   cost_scale: 0.05

      next_selector:
        type: "ImmediateBest"
      
      # evaluator_updator:
      #   type: "UpdateAll"
      #   update_gain: false
      #   update_cost: false
      #   update_value: true

  
      

back_tracker:
  # type: "RotateInPlace"
  type: "RotateReverse"
  turn_rate: 0.4
  update_rate: 1.0
  sampling_rate: 10.0
  n_rotations: 0
  stack_size: 10
